<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2. User modifications • ggOceanMaps</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="2. User modifications">
<meta property="og:description" content="ggOceanMaps">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggOceanMaps</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/get-started.html">1. Get started</a>
    </li>
    <li>
      <a href="../articles/known-issues.html">4. Known issues</a>
    </li>
    <li>
      <a href="../articles/premade-shapefiles.html">3. Pre-made shapefiles</a>
    </li>
    <li>
      <a href="../articles/user-modifications.html">2. User modifications</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MikkoVihtakari/ggOceanMaps/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="user-modifications_files/header-attrs-2.1/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>2. User modifications</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/MikkoVihtakari/ggOceanMaps/blob/master/vignettes/user-modifications.Rmd"><code>vignettes/user-modifications.Rmd</code></a></small>
      <div class="hidden name"><code>user-modifications.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggOceanMaps</span>)</pre></body></html></div>
<p>This section focuses on flexibility and user modifications. It is assumed that advanced users understand the basics of geographic information systems (GIS) and how to use these systems in R (e.g. see the <a href="https://geocompr.robinlovelace.net/adv-map.html">Making Maps with R</a> chapter in <a href="https://geocompr.robinlovelace.net/index.html">Lovelace et al. 2020</a>).</p>
<div id="projections" class="section level1">
<h1 class="hasAnchor">
<a href="#projections" class="anchor"></a>Projections</h1>
<p>The <code>basemap</code> function uses the <code>limits</code> argument to automatically detect the required projection for a map (or the <code>data</code> argument to calculate <code>limits</code>). The algorithms deciding which projection to use are defined in <code>define_shapefiles</code> and <code>shapefile_list</code> functions. These conditions are expected to change during the development of the package and documented information here or in the <code>basemap</code> function might be outdated. Make sure to check the projection definition functions for up-to-date information. At the time of writing, the function uses three different projections (given as <a href="https://epsg.io/">EPSG codes</a>):</p>
<ul>
<li>
<strong>3995</strong> WGS 84 / Arctic Polar Stereographic. Called “ArcticStereographic”. For max latitude (<code>limits[4]</code>) &gt;= 60 (if min latitude (<code>limits[3]</code>) &gt;= 30), and single integer latitudes &gt;= 30 and &lt;= 89.</li>
<li>
<strong>3031</strong> WGS 84 / Antarctic Polar Stereographic. Called “AntarcticStereographic”. For max latitude (<code>limits[4]</code>) &lt;= -60 (if min latitude (<code>limits[3]</code>) &lt;= -30), and single integer latitudes &lt;= -30 and &gt;= -89.</li>
<li>
<strong>4326</strong> WGS 84 / World Geodetic System 1984, used in GPS. Called “DecimalDegree”. For min latitude (<code>limits[3]</code>) &lt; 30 or &gt; -30, max latitude (<code>limits[4]</code>) &lt; 60 or &gt; -60, and single integer latitudes &lt; 30 and &gt; -30.</li>
</ul>
<p>The <code>basemap</code> function uses pre-transformed shapefiles for each of the projections above (defined in <code>shapefile_list</code>). This is to make the plotting quicker and more memory efficient but leads to larger data size required by the package.</p>
</div>
<div id="appearance" class="section level1">
<h1 class="hasAnchor">
<a href="#appearance" class="anchor"></a>Appearance</h1>
<div id="bathymetry-styles" class="section level2">
<h2 class="hasAnchor">
<a href="#bathymetry-styles" class="anchor"></a>Bathymetry styles</h2>
<p>The <code>basemap</code> function contains four pre-made bathymetry styles defined using the <code>bathy.style</code> argument. Two of these alternatives (<code>"poly_*"</code>) have been mapped to <code>fill</code> using the <code>geom_polygon</code> function, while the two others (<code>contour_*</code>) have been mapped to <code>color</code>. The default style (<code>"poly_blues"</code>) has been displayed throughout this user manual. The other styles are:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">46</span>, <span class="fl">70</span>, <span class="fl">81</span>), <span class="kw">bathymetry</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">bathy.style</span> <span class="kw">=</span> <span class="st">"poly_greys"</span>)</pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">46</span>, <span class="fl">70</span>, <span class="fl">81</span>), <span class="kw">bathymetry</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">bathy.style</span> <span class="kw">=</span> <span class="st">"contour_blues"</span>)</pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-2-2.png" width="700"></p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">46</span>, <span class="fl">70</span>, <span class="fl">81</span>), <span class="kw">bathymetry</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">bathy.style</span> <span class="kw">=</span> <span class="st">"contour_grey"</span>)</pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-2-3.png" width="700"></p>
<div id="customizing-bathymetry-styles" class="section level3">
<h3 class="hasAnchor">
<a href="#customizing-bathymetry-styles" class="anchor"></a>Customizing bathymetry styles</h3>
<p>The <code>bathy.style = "poly_*"</code> bathymetry polygons are mapped to <code>geom_fill_discrete</code> and can be modifying using standard ggplot syntax:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">140</span>, -<span class="fl">105</span>, <span class="fl">20</span>, <span class="fl">40</span>), <span class="kw">bathymetry</span> <span class="kw">=</span> <span class="fl">TRUE</span>) + <span class="fu">scale_fill_viridis_d</span>(<span class="st">"Water depth (m)"</span>)</pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>The <code>bathy.style = "contour_*"</code> bathymetry lines are mapped to <code>geom_color_discrete</code> and can be modifying using standard ggplot syntax:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">60</span>, <span class="fl">68</span>, <span class="fl">80</span>), <span class="kw">bathymetry</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">bathy.style</span> <span class="kw">=</span> <span class="st">"contour_blues"</span>) + <span class="fu">scale_color_hue</span>()</pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
</div>
</div>
<div id="graphical-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#graphical-parameters" class="anchor"></a>Graphical parameters</h2>
<p>The <code>basemap</code> function uses graphical parameters that (very objectively) happen to please the eye of the author and have worked in the applications needed by the author. The default parameters may suddenly change without warning. You may want to modify the appearances of a <code>basemap</code> to your own liking. This can be done using the <code>*.col</code> (fill), <code>*.border.col</code> (line color) and <code>*.size</code> (line width) arguments:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">55</span>, <span class="fl">70</span>), <span class="kw">glaciers</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
        <span class="kw">bathymetry</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">bathy.style</span> <span class="kw">=</span> <span class="st">"poly_greys"</span>,
        <span class="kw">land.col</span> <span class="kw">=</span> <span class="st">"#eeeac4"</span>, <span class="kw">gla.col</span> <span class="kw">=</span> <span class="st">"cadetblue"</span>,
        <span class="kw">land.border.col</span> <span class="kw">=</span> <span class="fl">NA</span>, <span class="kw">gla.border.col</span> <span class="kw">=</span> <span class="fl">NA</span>,
        <span class="kw">grid.size</span> <span class="kw">=</span> <span class="fl">0.05</span>)</pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Grid lines can be removed by setting the <code>grid.col</code> to <code>NA</code>. Axis labels can be manipulated using standard ggplot code:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">124</span>, <span class="fl">148</span>, <span class="fl">31</span>, <span class="fl">50</span>), <span class="kw">grid.col</span> <span class="kw">=</span> <span class="fl">NA</span>) + <span class="fu">labs</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">"Only latitude for you, ..."</span>)</pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
</div>
<div id="add-scale-bar-and-north-arrow" class="section level2">
<h2 class="hasAnchor">
<a href="#add-scale-bar-and-north-arrow" class="anchor"></a>Add scale bar and north arrow</h2>
<p>Scale bar and north arrows can be added using the <a href="https://cran.r-project.org/web/packages/ggspatial/vignettes/ggspatial.html"><strong>ggspatial</strong> functions</a> (the package is automatically loaded when you use ggOceanMaps):</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">75</span>, -<span class="fl">45</span>, <span class="fl">62</span>, <span class="fl">78</span>), <span class="kw">rotate</span> <span class="kw">=</span> <span class="fl">TRUE</span>) +
  <span class="fu">annotation_scale</span>(<span class="kw">location</span> <span class="kw">=</span> <span class="st">"br"</span>) +
  <span class="fu">annotation_north_arrow</span>(<span class="kw">location</span> <span class="kw">=</span> <span class="st">"tr"</span>, <span class="kw">which_north</span> <span class="kw">=</span> <span class="st">"true"</span>)</pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Note that the north arrow in the example above points towards North where it is placed and that the direction of North varies as shown by the meridians. The scale bar is correct at 71 <span class="math inline">\(\circ\)</span>N latitude as specified by the projection (crs = 3995) for Arctic stereographic maps.</p>
</div>
</div>
<div id="modifying-basemap-objects" class="section level1">
<h1 class="hasAnchor">
<a href="#modifying-basemap-objects" class="anchor"></a>Modifying basemap objects</h1>
<p>The objects produced by the <code>basemap</code> function are standard ggplot objects with the difference that relevant information used in mapping is added to <code>attributes</code> of the object:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/basemap.html">basemap</a></span>(-<span class="fl">60</span>)
<span class="fu"><a href="https://rdrr.io/r/base/attributes.html">attributes</a></span>(<span class="no">p</span>)
<span class="co">#&gt; $names</span>
<span class="co">#&gt; [1] "data"        "layers"      "scales"      "mapping"     "theme"      </span>
<span class="co">#&gt; [6] "coordinates" "facet"       "plot_env"    "labels"     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $class</span>
<span class="co">#&gt; [1] "gg"          "ggplot"      "ggOceanMaps"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bathymetry</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $glaciers</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $limits</span>
<span class="co">#&gt; [1] -3333134  3333134 -3333134  3333134</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $polarmap</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $crs</span>
<span class="co">#&gt; [1] 3031</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $proj</span>
<span class="co">#&gt; [1] "+proj=stere +lat_0=-90 +lat_ts=-71 +lon_0=0 +k=1 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0"</span></pre></body></html></div>
<p>Accessing the <code>attributes</code> allow custom modifications of maps produced by the <code>basemap</code> function. See the <a href="#reordering">Reordering layers</a> section as an example.</p>
<div id="reordering" class="section level2">
<h2 class="hasAnchor">
<a href="#reordering" class="anchor"></a>Reordering layers</h2>
<p>Sometimes there is a need to move land, glacier, and grid layers on top of spatial data added on a <code>basemap</code>. This can be done using the <code>reorder_layers</code> function. This example uses Norwegian fishing regions (Hovedområder f.o.m. 2018), which can be downloaded from the <a href="https://kart.fiskeridir.no/stat">Norwegian Directorate of Fisheries data portal</a> (use “ESRI shapefile” option). The example works for any spatial polygons with crs information, however.</p>
<p>The Norwegian fishing regions are included as an example dataset in the <strong>ggOceanMaps</strong> package. You can download these data and use the <code><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">rgdal::readOGR</a></code> function to read the shapefile if you wish to follow the example fully.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">fishingAreasNor</span>)

<span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="kw pkg">raster</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span>(<span class="no">fishingAreasNor</span>)[<span class="fl">1</span>:<span class="fl">4</span>]) +
  <span class="fu">annotation_spatial</span>(<span class="no">fishingAreasNor</span>, <span class="kw">fill</span> <span class="kw">=</span> <span class="fl">NA</span>) +
  <span class="fu">coord_sf</span>(<span class="kw">expand</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>The initial plot draws the polygons. Note how we had to add <code>coord_sf(expand = FALSE)</code> because <code>layer_spatial</code> and <code>annotation_spatial</code> functions from the ggspatial package seem to modify <code>coord_sf</code> when added to the plot. The <code>basemap</code> function uses <code>expand = FALSE</code> (run the script without the addition and see the difference). Note also how the polygon boundaries are partly on land. We want to eventually hide them under land. We also add region labels and color the polygons based on their area to demonstrate the capabilities of ggplot, ggspatial and ggOceanMaps:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">labels</span> <span class="kw">&lt;-</span> <span class="kw pkg">sp</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/SpatialPoints.html">SpatialPointsDataFrame</a></span>(<span class="kw pkg">rgeos</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgeos/man/topo-unary-gCentroid.html">gCentroid</a></span>(<span class="no">fishingAreasNor</span>, <span class="kw">byid</span><span class="kw">=</span><span class="fl">TRUE</span>),
                                     <span class="kw">data</span> <span class="kw">=</span> <span class="no">fishingAreasNor</span>@<span class="kw">data</span>)
<span class="no">fishingAreasNor</span>@<span class="kw">data</span>$<span class="no">area</span> <span class="kw">&lt;-</span> <span class="kw pkg">raster</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/area.html">area</a></span>(<span class="no">fishingAreasNor</span>)/<span class="fl">1e9</span> <span class="co"># calculate area in 1000 km2</span>

<span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="kw pkg">raster</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extent.html">extent</a></span>(<span class="no">fishingAreasNor</span>)[<span class="fl">1</span>:<span class="fl">4</span>]) +
  <span class="fu">annotation_spatial</span>(<span class="no">fishingAreasNor</span>, <span class="fu">aes</span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">area</span>)) +
  <span class="fu">geom_spatial_text</span>(<span class="kw">data</span> <span class="kw">=</span> <span class="fu">df_spatial</span>(<span class="no">labels</span>), <span class="fu">aes</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">y</span>, <span class="kw">label</span> <span class="kw">=</span> <span class="no">FID</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fu"><a href="../reference/FS.html">FS</a></span>(<span class="fl">8</span>), <span class="kw">fontface</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu">scale_fill_distiller</span>(<span class="kw">name</span> <span class="kw">=</span> <span class="st">"Area\n(1000 km2)"</span>,
                       <span class="kw">palette</span> <span class="kw">=</span> <span class="st">"Spectral"</span>, <span class="kw">na.value</span> <span class="kw">=</span> <span class="st">"white"</span>,
                       <span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">500</span>), <span class="kw">oob</span> <span class="kw">=</span> <span class="kw pkg">scales</span><span class="kw ns">::</span><span class="no"><a href="https://scales.r-lib.org//reference/squish.html">squish</a></span>)

<span class="fu"><a href="../reference/reorder_layers.html">reorder_layers</a></span>(<span class="no">p</span>)</pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Ideally, the region labels should not go under land. This can be fixed by plotting the labels on top of the reordered ggplot object. To demonstrate how to reorder layers, we do this manually here:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">p</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/reorder_layers.html">reorder_layers</a></span>(<span class="no">p</span>)
<span class="no">tmp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">p</span>$<span class="no">layers</span>, <span class="kw">function</span>(<span class="no">k</span>) !<span class="fu"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(<span class="no">k</span>$<span class="no">mapping</span>$<span class="no">label</span>)) <span class="co"># the layer with label mapping</span>
<span class="no">p</span>$<span class="no">layers</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">p</span>$<span class="no">layers</span>[-<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">tmp</span>)], <span class="no">p</span>$<span class="no">layers</span>[<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">tmp</span>)])
<span class="no">p</span></pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div id="custom-shapefiles" class="section level2">
<h2 class="hasAnchor">
<a href="#custom-shapefiles" class="anchor"></a>Custom shapefiles</h2>
<p>The <strong>ggOceanMaps package uses vector (spatial polygon) data</strong> to make the plotting more efficient and to produce sharp images at any resolution. For the time being, the package supports three kinds of shapefiles: 1) land shapes, 2) glacier shapes, and 3) bathymetry shapes. Each of these shapes has to be defined using the same projection. Since the shapefiles are large and generating them may require long processing time, it is most convenient to save them in a Rdata file as <code>sp::SpatialPolygonsDataFrames</code> objects and load them to the memory when used to make a map. Useful sources for spatial data are:</p>
<p><strong>Vector data</strong></p>
<ul>
<li>
<a href="http://www.naturalearthdata.com/downloads/10m-physical-vectors/">Natural Earth Data</a> provides polygon data in relatively high detail for the entire Earth. Used as data-source for land and glacier shapes throughout the package, except for the most detailed maps.</li>
<li>
<a href="https://www.kartverket.no/en/data/Open-and-Free-geospatial-data-from-Norway/">Norwegian Mapping Authority</a> provides high-resolution spatial data for mainland Norway and Svalbard. <!-- Used as data-source for detailed coastal Norwegian maps as well as for detailed bathymetry in Svalbard maps. -->
</li>
<li>
<a href="https://geodata.npolar.no/">Norwegian Polar Institute</a> provides high-resolution vector data for Norwegian polar regions. <!-- Used as data-source for detailed Svalbard maps.  -->
</li>
</ul>
<p><strong>Raster data for bathymetry</strong></p>
<ul>
<li>
<a href="https://www.gebco.net/data_and_products/gridded_bathymetry_data/gebco_2019/gebco_2019_info.html">GEBCO Compilation Group (2019) GEBCO 2019 15-arcsecond grid</a>. The highest resolution open bathymetry grid available at the moment. Referred to as “GEBCO data”.</li>
<li>
<a href="https://doi.org/10.7289/V5C8276M">ETOPO1 1 Arc-Minute Global Relief Model</a>. Can also be accessed using the <a href="https://www.rdocumentation.org/packages/marmap/versions/1.0.3/topics/getNOAA.bathy"><code>marmap::getNOAA.bathy</code></a> (see <a href="#making">Section 1</a>). Referred to as “NOAA data” and “ETOPO1 data”.</li>
</ul>
<p>There are probably more sources which the author has not needed yet. Please send an email to add more options to the list. The bathymetry datasets are large and require vectorization before they can be plotted in <em>ggplot2</em> within a reasonable time.</p>
<p>Here we go through how to plot customized shapefiles for the Barents Sea as an example. A similar procedure can be applied to any region in the world.</p>
<div id="bathymetries" class="section level3">
<h3 class="hasAnchor">
<a href="#bathymetries" class="anchor"></a>Bathymetries</h3>
<p>The <a href="http://www.naturalearthdata.com/downloads/10m-physical-vectors/">Natural Earth Data</a> provides bathymetry vector data, which can be readily used in ggOceanMaps. The contours in that dataset are, however, not very practical for marine biology and fisheries in shallow seas such as the Barents Sea. Download the <a href="https://www.ngdc.noaa.gov/mgg/global/relief/ETOPO1/data/ice_surface/grid_registered/netcdf/">ETOPO1 dataset as grid registered NetCDF gmt4</a> to a folder in your computer. It may be beneficial to make a “GIS” or “Shapefiles” folder where you store similar datasets for later use. Whether you use ice or bed-rock surface does not matter for this example as there are no glaciers under the sea-level within the region of interest. In any case, this choice has no visual effect because land and glaciers will be plotted on top of the bathymetry, but the ice surface option will lead to smaller file size.</p>
<p>The bathymetry needs first to be reclassified and formatted for the consequent vectorization step. First, we need to define the location of the ETOPO1 dataset and to find limits for our region in decimal degrees. The limits can be found using the <code>basemap</code> function. It is advised to use slightly wider limits than the region of interest.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">etopoPath</span> <span class="kw">&lt;-</span> <span class="st">""</span> <span class="co"># Replace by the path to the folder where the ETOPO1 grd file is located.</span>
<span class="no">lims</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">8</span>, <span class="fl">65</span>, <span class="fl">68</span>, <span class="fl">82</span>)
<span class="no">projection</span> <span class="kw">&lt;-</span> <span class="st">"+init=epsg:32636"</span>
<span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="no">lims</span>)</pre></body></html></div>
<p>We also need to define an appropriate projection. We will use the <a href="http://epsg.io/32636">UTM 36N zone projection</a>, which is approximately in the middle of our area of interest. We define higher resolution contour in depths 0-500 m because our area of interest is relatively shallow. The <code>raster_bathymetry</code> function is relatively slow for large data. The <code>aggregation.factor</code> argument can be used to reduce file size but will influence the resolution of the resulting shapefile (higher factors lead to a lower resolution).</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">rb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/raster_bathymetry.html">raster_bathymetry</a></span>(<span class="kw">bathy</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">etopoPath</span>, <span class="st">"ETOPO1_Ice_g_gmt4.grd"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"/"</span>),
                        <span class="kw">depths</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">300</span>, <span class="fl">500</span>, <span class="fl">1000</span>, <span class="fl">1500</span>, <span class="fl">2000</span>, <span class="fl">4000</span>, <span class="fl">6000</span>, <span class="fl">10000</span>),
                        <span class="kw">proj.out</span> <span class="kw">=</span> <span class="no">projection</span>,
                        <span class="kw">boundary</span> <span class="kw">=</span> <span class="no">lims</span>
)</pre></body></html></div>
<p>Now we have the bathyRaster object which can be vectorized:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">rb</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">rb</span>)
<span class="kw pkg">raster</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(<span class="no">rb</span>$<span class="no">raster</span>)</pre></body></html></div>
<p>The vectorization is done using the <code>vector_bathymetry</code> function. The <code>drop.crumbs</code> and <code>remove.holes</code> parameters can be used to reduce the file size, while the <code>smooth</code> parameter makes the contours look smoother under high zoom levels. Note that the smoothing of raster cell edges is completely arbitrary and may lead to map contours that do not exist in reality.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">bs_bathy</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/vector_bathymetry.html">vector_bathymetry</a></span>(<span class="no">rb</span>)
<span class="kw pkg">sp</span><span class="kw ns">::</span><span class="fu">plot</span>(<span class="no">bs_bathy</span>)</pre></body></html></div>
</div>
<div id="land-shapes" class="section level3">
<h3 class="hasAnchor">
<a href="#land-shapes" class="anchor"></a>Land shapes</h3>
<p>Land shapes could theoretically be defined from the bathymetry raster (depth = 0). Nevertheless, since the <a href="http://www.naturalearthdata.com/downloads/10m-physical-vectors/">10m Natural Earth Data</a> vectors are of high resolution, there has been no need to write a function to do this. We use Natural Earth Data instead. Download the Natural Earth Data <a href="http://www.naturalearthdata.com/downloads/10m-physical-vectors/">Land and Minor Islands</a> vectors to your “GIS” or “Shapefiles” folder and define folder paths under:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">NEDPath</span> <span class="kw">&lt;-</span> <span class="st">""</span> <span class="co"># Natural Earth Data location</span>
<span class="no">outPath</span> <span class="kw">&lt;-</span> <span class="st">""</span> <span class="co"># Data output location</span></pre></body></html></div>
<p>Once done, we go ahead and process the shapefiles:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">world</span> <span class="kw">&lt;-</span> <span class="kw pkg">rgdal</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">NEDPath</span>, <span class="st">"ne_10m_land/ne_10m_land.shp"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"/"</span>))
<span class="no">islands</span> <span class="kw">&lt;-</span> <span class="kw pkg">rgdal</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">NEDPath</span>, <span class="st">"ne_10m_minor_islands/ne_10m_minor_islands.shp"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"/"</span>))
<span class="no">world</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="no">world</span>, <span class="no">islands</span>)

<span class="no">bs_land</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/clip_shapefile.html">clip_shapefile</a></span>(<span class="no">world</span>, <span class="no">lims</span>)
<span class="no">bs_land</span> <span class="kw">&lt;-</span> <span class="kw pkg">sp</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/spTransform.html">spTransform</a></span>(<span class="no">bs_land</span>, <span class="kw">CRSobj</span> <span class="kw">=</span> <span class="kw pkg">sp</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/CRS-class.html">CRS</a></span>(<span class="no">projection</span>))
<span class="kw pkg">rgeos</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgeos/man/pred-unary-gIsValid.html">gIsValid</a></span>(<span class="no">bs_land</span>) <span class="co"># Has to return TRUE, if not use rgeos::gBuffer</span>
<span class="no">bs_land</span> <span class="kw">&lt;-</span> <span class="kw pkg">rgeos</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgeos/man/misc-gBuffer.html">gBuffer</a></span>(<span class="no">bs_land</span>, <span class="kw">byid</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0</span>)
<span class="kw pkg">sp</span><span class="kw ns">::</span><span class="fu">plot</span>(<span class="no">bs_land</span>)</pre></body></html></div>
</div>
<div id="glacier-shapes" class="section level3">
<h3 class="hasAnchor">
<a href="#glacier-shapes" class="anchor"></a>Glacier shapes</h3>
<p>Download the Natural Earth Data <a href="http://www.naturalearthdata.com/downloads/10m-physical-vectors/">Glaciated Areas</a> vectors to your <code>NEDPath</code>.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">glaciers</span> <span class="kw">&lt;-</span> <span class="kw pkg">rgdal</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgdal/man/readOGR.html">readOGR</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">NEDPath</span>, <span class="st">"ne_10m_glaciated_areas/ne_10m_glaciated_areas.shp"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"/"</span>))
<span class="kw pkg">rgeos</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgeos/man/pred-unary-gIsValid.html">gIsValid</a></span>(<span class="no">glaciers</span>) <span class="co"># Needs buffering</span>
<span class="no">glaciers</span> <span class="kw">&lt;-</span> <span class="kw pkg">rgeos</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgeos/man/misc-gBuffer.html">gBuffer</a></span>(<span class="no">glaciers</span>, <span class="kw">byid</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">width</span> <span class="kw">=</span> <span class="fl">0</span>)

<span class="no">bs_glacier</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/clip_shapefile.html">clip_shapefile</a></span>(<span class="no">glaciers</span>, <span class="no">lims</span>)
<span class="no">bs_glacier</span> <span class="kw">&lt;-</span> <span class="kw pkg">sp</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/spTransform.html">spTransform</a></span>(<span class="no">bs_glacier</span>, <span class="kw">CRSobj</span> <span class="kw">=</span> <span class="kw pkg">sp</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/CRS-class.html">CRS</a></span>(<span class="no">projection</span>))
<span class="kw pkg">rgeos</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/rgeos/man/pred-unary-gIsValid.html">gIsValid</a></span>(<span class="no">bs_glacier</span>)
<span class="kw pkg">sp</span><span class="kw ns">::</span><span class="fu">plot</span>(<span class="no">bs_glacier</span>)</pre></body></html></div>
</div>
<div id="plotting-the-shapefiles-using-basemap" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-the-shapefiles-using-basemap" class="anchor"></a>Plotting the shapefiles using basemap</h3>
<p>Now that we have the shapefiles, we can save them to a file so that we do not run the script above every time we plot a map using custom shapefiles.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span>(<span class="no">bs_bathy</span>, <span class="no">bs_land</span>, <span class="no">bs_glacier</span>, <span class="kw">file</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="no">outPath</span>, <span class="st">"bs_shapes.rda"</span>, <span class="kw">sep</span> <span class="kw">=</span> <span class="st">"/"</span>), <span class="kw">compress</span> <span class="kw">=</span> <span class="st">"xz"</span>)</pre></body></html></div>
<p>The shapefiles can now be plotted using the <code>basemap</code> function:</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">shapefiles</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">land</span> <span class="kw">=</span> <span class="no">bs_land</span>, <span class="kw">glacier</span> <span class="kw">=</span> <span class="no">bs_glacier</span>, <span class="kw">bathy</span> <span class="kw">=</span> <span class="no">bs_bathy</span>), <span class="kw">bathymetry</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">glaciers</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>The list elements <code>land</code>, <code>glacier</code> and <code>bathy</code> are required, but <code>glacier</code> and <code>bathy</code> can be set to <code>NULL</code> if <code>bathymetry</code> and <code>glaciers</code> are set to <code>FALSE</code>, respectively. This means that you are not forced to define bathymetries and glaciers for your custom shapefile maps if plotting them is not desired. Note how the map becomes plotted outside its actual limits. This issue will hopefully be fixed in the future. The map can be limited using the <code>limits</code> or <code>data</code> arguments as any <code>basemap</code>:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="../reference/basemap.html">basemap</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">10</span>, <span class="fl">53</span>, <span class="fl">70</span>, <span class="fl">80</span>), <span class="kw">shapefiles</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">land</span> <span class="kw">=</span> <span class="no">bs_land</span>, <span class="kw">glacier</span> <span class="kw">=</span> <span class="no">bs_glacier</span>, <span class="kw">bathy</span> <span class="kw">=</span> <span class="no">bs_bathy</span>), <span class="kw">bathymetry</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">glaciers</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="user-modifications_files/figure-html/unnamed-chunk-22-1.png" width="700"></p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mikko Vihtakari.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
